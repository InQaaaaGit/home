<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="local/cdo_ag_tools/db" VERSION="20231214" COMMENT="XMLDB file for local_cdo_ag_tools plugin"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <TABLE NAME="local_cdo_ag_tools_1c_queue" COMMENT="Queue for 1C grade synchronization">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="grade_data" TYPE="text" NOTNULL="true" COMMENT="JSON data of the grade to be sent to 1C"/>
        <FIELD NAME="status" TYPE="char" LENGTH="20" NOTNULL="true" DEFAULT="pending" COMMENT="Status: pending, sent, failed"/>
        <FIELD NAME="created_at" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when record was created"/>
        <FIELD NAME="sent_at" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Timestamp when record was successfully sent"/>
        <FIELD NAME="last_attempt" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Timestamp of last attempt"/>
        <FIELD NAME="attempts" TYPE="int" LENGTH="3" NOTNULL="true" DEFAULT="0" COMMENT="Number of send attempts"/>
        <FIELD NAME="error_message" TYPE="text" NOTNULL="false" COMMENT="Last error message if failed"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="status_idx" UNIQUE="false" FIELDS="status"/>
        <INDEX NAME="created_at_idx" UNIQUE="false" FIELDS="created_at"/>
        <INDEX NAME="status_created_idx" UNIQUE="false" FIELDS="status, created_at"/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="local_cdo_ag_tools_grades_1c" COMMENT="Grades for 1C synchronization">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="course_id" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Course ID"/>
        <FIELD NAME="user_id" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="User ID"/>
        <FIELD NAME="grade" TYPE="number" LENGTH="10" DECIMALS="5" NOTNULL="true" COMMENT="Grade value"/>
        <FIELD NAME="section_id" TYPE="int" LENGTH="10" NOTNULL="false" COMMENT="Section ID"/>
        <FIELD NAME="item_type" TYPE="char" LENGTH="50" NOTNULL="true" COMMENT="Grade item type"/>
        <FIELD NAME="created_at" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when record was created"/>
        <FIELD NAME="updated_at" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when record was last updated"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="course_user_idx" UNIQUE="false" FIELDS="course_id, user_id"/>
        <INDEX NAME="user_idx" UNIQUE="false" FIELDS="user_id"/>
        <INDEX NAME="course_idx" UNIQUE="false" FIELDS="course_id"/>
        <INDEX NAME="section_idx" UNIQUE="false" FIELDS="section_id"/>
        <INDEX NAME="created_at_idx" UNIQUE="false" FIELDS="created_at"/>
      </INDEXES>
    </TABLE>
    <TABLE NAME="local_cdo_ag_work_notif" COMMENT="Tracking of work upload and grade notifications">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="User ID"/>
        <FIELD NAME="courseid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Course ID"/>
        <FIELD NAME="assignmentid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Assignment ID"/>
        <FIELD NAME="submissionid" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Submission ID"/>
        <FIELD NAME="upload_notified" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" COMMENT="Upload notification sent flag"/>
        <FIELD NAME="grade_notified" TYPE="int" LENGTH="1" NOTNULL="true" DEFAULT="0" COMMENT="Grade notification sent flag"/>
        <FIELD NAME="timecreated" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when record was created"/>
        <FIELD NAME="timemodified" TYPE="int" LENGTH="10" NOTNULL="true" COMMENT="Timestamp when record was last updated"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="userid_idx" UNIQUE="false" FIELDS="userid"/>
        <INDEX NAME="courseid_idx" UNIQUE="false" FIELDS="courseid"/>
        <INDEX NAME="assignmentid_idx" UNIQUE="false" FIELDS="assignmentid"/>
        <INDEX NAME="submissionid_idx" UNIQUE="false" FIELDS="submissionid"/>
        <INDEX NAME="user_submission_idx" UNIQUE="false" FIELDS="userid, submissionid"/>
      </INDEXES>
    </TABLE>
  </TABLES>
</XMLDB> 